/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package UI;


import com.sun.javafx.scene.control.skin.ChoiceBoxSkin;
import java.awt.event.KeyEvent;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import javax.swing.*;
import static javax.swing.JOptionPane.OK_OPTION;


/**
 *
 * @author erik
 */
public class PersonalData extends javax.swing.JFrame {
    private Connection conexion;
    private PreparedStatement pst;
    private ResultSet rs;
    String cod;
    String enfer; 
    /**
     * Creates new form PersonalData
     */
    public PersonalData() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel1 = new javax.swing.JPanel();
        Title = new javax.swing.JLabel();
        LblDesease = new javax.swing.JLabel();
        LblFrec = new javax.swing.JLabel();
        LblSex = new javax.swing.JLabel();
        LblStatus = new javax.swing.JLabel();
        LblAlergia = new javax.swing.JLabel();
        LblAge = new javax.swing.JLabel();
        TxtAge = new javax.swing.JTextField();
        ComboDesease = new javax.swing.JComboBox<>();
        ComboAllergy = new javax.swing.JComboBox<>();
        ComboStatus = new javax.swing.JComboBox<>();
        ComboSex = new javax.swing.JComboBox<>();
        ComboFrec = new javax.swing.JComboBox<>();
        BtnBack = new javax.swing.JButton();
        BtnGuardar = new javax.swing.JButton();
        Background = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        jPanel1.setLayout(null);

        Title.setFont(new java.awt.Font("Montserrat Medium", 1, 14)); // NOI18N
        Title.setText("Datos Personales");
        jPanel1.add(Title);
        Title.setBounds(100, 120, 170, 18);

        LblDesease.setFont(new java.awt.Font("Futura Bk BT", 1, 14)); // NOI18N
        LblDesease.setText("Tiene alguna Enfermedad?");
        jPanel1.add(LblDesease);
        LblDesease.setBounds(70, 390, 230, 18);

        LblFrec.setFont(new java.awt.Font("Futura Bk BT", 1, 14)); // NOI18N
        LblFrec.setText("Frecuencia");
        jPanel1.add(LblFrec);
        LblFrec.setBounds(60, 260, 80, 18);

        LblSex.setFont(new java.awt.Font("Futura Bk BT", 1, 14)); // NOI18N
        LblSex.setText("Sexo");
        jPanel1.add(LblSex);
        LblSex.setBounds(100, 230, 41, 18);

        LblStatus.setFont(new java.awt.Font("Futura Bk BT", 1, 14)); // NOI18N
        LblStatus.setText("Estado");
        jPanel1.add(LblStatus);
        LblStatus.setBounds(90, 290, 50, 18);

        LblAlergia.setFont(new java.awt.Font("Futura Bk BT", 1, 14)); // NOI18N
        LblAlergia.setText("Tiene alguna alergia?");
        jPanel1.add(LblAlergia);
        LblAlergia.setBounds(80, 320, 160, 30);

        LblAge.setFont(new java.awt.Font("Futura Bk BT", 1, 14)); // NOI18N
        LblAge.setText("Edad");
        jPanel1.add(LblAge);
        LblAge.setBounds(100, 190, 41, 18);

        TxtAge.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                TxtAgeKeyPressed(evt);
            }
        });
        jPanel1.add(TxtAge);
        TxtAge.setBounds(160, 190, 40, 28);

        ComboDesease.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Si","NO" }));
        jPanel1.add(ComboDesease);
        ComboDesease.setBounds(110, 430, 120, 26);

        ComboAllergy.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Si", "No"}));
        jPanel1.add(ComboAllergy);
        ComboAllergy.setBounds(110, 350, 120, 26);

        ComboStatus.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Soltero","Pareja Estable" }));
        jPanel1.add(ComboStatus);
        ComboStatus.setBounds(160, 290, 120, 26);

        ComboSex.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Masculino", "Femenino"}));
        jPanel1.add(ComboSex);
        ComboSex.setBounds(160, 230, 120, 26);

        ComboFrec.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Alta", "Media", "Baja", "Ninguna" }));
        jPanel1.add(ComboFrec);
        ComboFrec.setBounds(160, 260, 120, 26);

        BtnBack.setText("Volver");
        BtnBack.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                BtnBackMouseClicked(evt);
            }
        });
        jPanel1.add(BtnBack);
        BtnBack.setBounds(100, 560, 140, 50);

        BtnGuardar.setText("Guardar");
        BtnGuardar.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                BtnGuardarMouseClicked(evt);
            }
        });
        jPanel1.add(BtnGuardar);
        BtnGuardar.setBounds(100, 490, 140, 50);

        Background.setIcon(new javax.swing.ImageIcon(getClass().getResource("/free/DatosP.png"))); // NOI18N
        jPanel1.add(Background);
        Background.setBounds(0, 0, 360, 640);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, 360, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(jPanel1, javax.swing.GroupLayout.PREFERRED_SIZE, 640, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(0, 0, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void TxtAgeKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_TxtAgeKeyPressed
        // TODO add your handling code here:
        
        String value = TxtAge.getText();
        int l = value.length();
        if (evt.getKeyChar() >= '0' && evt.getKeyChar() <= '9'|| evt.getKeyCode()==KeyEvent.VK_BACK_SPACE) {
            TxtAge.setEditable(true);
        }else{
            if(KeyEvent.VK_ENTER == evt.getKeyCode()){
            ComboSex.requestFocus();
            TxtAge.setEditable(true);
            }else{
              TxtAge.setEditable(false);  
            }
        }
    }//GEN-LAST:event_TxtAgeKeyPressed

    private void BtnGuardarMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_BtnGuardarMouseClicked
        // TODO add your handling code here:
        Recommend MM = new Recommend();
        boolean Aller, Sick;
        //alergias
        MedicalData MED = new MedicalData();
        
        
        //enfermedades
        
        Aller = ComboAllergy.getSelectedItem().equals("Si");
        Sick = ComboDesease.getSelectedItem().equals("Si");
        
        if(Aller){
            if(Sick){
               cod=(String) JOptionPane.showInputDialog(null, "seleccione","enfermedad", JOptionPane.QUESTION_MESSAGE, null,MED.cond,MED.cond[1]);
               enfer= (String) JOptionPane.showInputDialog(null, "seleccione","enfermedad", JOptionPane.QUESTION_MESSAGE, null,MED.enf,MED.enf[1]);
            }else{
                //mostrar solo alergia
                cod=(String) JOptionPane.showInputDialog(null,"seleccione","enfermedad", JOptionPane.QUESTION_MESSAGE, null,MED.cond,MED.cond[1]);
            }
        }else{
            if(Sick){
               enfer= (String) JOptionPane.showInputDialog(null, "seleccione","enfermedad", JOptionPane.QUESTION_MESSAGE, null,MED.enf,MED.enf[1]);
            }
        }
            
            try {
              conexion = Conection.conexion();
                    pst = conexion.prepareStatement("Insert INTO personal_data(age,sex,freq,estado,allergy,desease) VALUES (?,?,?,?,?,?)");
                    int edad = Integer.parseInt(TxtAge.getText());
                    pst.setInt(1,edad);
                    pst.setString(2, (String) ComboSex.getSelectedItem());
                    pst.setString(3, (String) ComboFrec.getSelectedItem());
                    pst.setString(4, (String) ComboStatus.getSelectedItem());
                    pst.setString(5, cod);
                    pst.setString(6, enfer);
                    if (pst.executeUpdate() > 0) {
                        cerrarConexion();
                        JOptionPane.showMessageDialog( null, "Datos agregados con exito");
                        MM.setVisible(true);
                        this.setVisible(false);
                        String texto="";
                        for(int i=0;i<MED.anti.length;i++){
                           texto+=MED.anti[i]+"\n";
                        }
                        MM.jTextArea1.setText(texto);
                        
                     } else {
                        JOptionPane.showMessageDialog(null, "Intente de nuevo");
                    }
            }catch (Exception a) {
                System.out.println(a.getMessage());
                JOptionPane.showMessageDialog(null, "Algo salio mal: " + a.getMessage());
            }
        
        
    }//GEN-LAST:event_BtnGuardarMouseClicked

    private void BtnBackMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_BtnBackMouseClicked
        // TODO add your handling code here:
        MainMenu MM = new MainMenu();
        MM.setVisible(true);
        this.setVisible(false);
    }//GEN-LAST:event_BtnBackMouseClicked

    /**
     * @param args the command line arguments
     */
    
    
    
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(PersonalData.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(PersonalData.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(PersonalData.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(PersonalData.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new PersonalData().setVisible(true);
            }
        });
    }
    
    

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel Background;
    private javax.swing.JButton BtnBack;
    private javax.swing.JButton BtnGuardar;
    private javax.swing.JComboBox<String> ComboAllergy;
    private javax.swing.JComboBox<String> ComboDesease;
    private javax.swing.JComboBox<String> ComboFrec;
    private javax.swing.JComboBox<String> ComboSex;
    private javax.swing.JComboBox<String> ComboStatus;
    private javax.swing.JLabel LblAge;
    private javax.swing.JLabel LblAlergia;
    private javax.swing.JLabel LblDesease;
    private javax.swing.JLabel LblFrec;
    private javax.swing.JLabel LblSex;
    private javax.swing.JLabel LblStatus;
    private javax.swing.JLabel Title;
    private javax.swing.JTextField TxtAge;
    private javax.swing.JPanel jPanel1;
    // End of variables declaration//GEN-END:variables

   private void cerrarConexion() {
        try {
            if (rs != null) {
                rs.close();
            }
            if (pst != null) {
                pst.close();
            }
            if (conexion != null) {
                conexion.close();
            }
        } catch (Exception e) {
            System.err.println("Error al cerrar conexiones - DaoUsuario " + e.getMessage());
        }
   }
}
